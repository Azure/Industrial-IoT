# Starter pipeline

# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

pool:
  name: 'Azure-IoT-Manufacturing'

steps:
- task: PowerShell@2
  inputs:
    targetType: 'filePath'
    filePath: $(System.DefaultWorkingDirectory)\tools\e2etesting\DownloadIAIBinaries.ps1
    workingDirectory: 
    arguments: > # Use this to avoid newline characters in multiline string
      -IAIVersion "2.7.160"

- task: AzureKeyVault@1
  inputs:
    azureSubscription: 'IOT-OPC-WALLS-MSI'
    KeyVaultName: 'automatedtesting'
    SecretsFilter: '*'

- task: AzurePowerShell@4
  inputs:
    azureSubscription: 'IOT-OPC-WALLS-MSI'
    azurePowerShellVersion: 'latestVersion'
    workingDirectory: '$(System.DefaultWorkingDirectory)\tools\e2etesting\'
    scriptType: filePath
    scriptPath: '$(System.DefaultWorkingDirectory)\tools\e2etesting\ReplaceVariablesInAppSettings.ps1'
    scriptArguments: > # Use this to avoid newline characters in multiline string
      -ClientId "$(IAIClientId)"
      -ClientSecret "$(IAIClientSecret)"
      -ApplicationName "$(ApplicationName)"
      -AppSettingsFilename "appSettings.json"
